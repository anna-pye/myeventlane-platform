/**
 * @file
 * Vendor Event Wizard form wrapper styles (Phase 4 A5).
 *
 * Mobile-first. Header, body, sticky footer CTA. Clear spacing, visible focus
 * states. No absolute-positioning hacks. Desktop centred and calm; mobile CTA
 * always reachable. No overlap with messages/errors.
 */

@use '../tokens/colors' as *;
@use '../tokens/spacing' as *;
@use '../tokens/typography' as *;
@use '../tokens/breakpoints' as *;
@use '../tokens/radii' as *;
@use '../tokens/shadows' as *;

// ============================================================================
// FORM CONTAINER
// ============================================================================

.mel-wizard-form {
  width: 100%;
  min-height: 100vh;

  @include respond-to(md) {
    min-height: auto;
  }
}

// ============================================================================
// WRAPPER (mobile-first)
// ============================================================================

.mel-wizard-form-wrap {
  display: flex;
  flex-direction: column;
  gap: $spacing-4;
  width: 100%;
  max-width: 100%;
  min-height: 0;

  @include respond-to(md) {
    gap: $spacing-6;
    max-width: $layout-content-max-width;
    margin-left: auto;
    margin-right: auto;
    padding-left: $spacing-4;
    padding-right: $spacing-4;
  }
}

// ============================================================================
// WIZARD HEADER
// ============================================================================

.mel-wizard-form-header {
  flex-shrink: 0;
  padding-bottom: $spacing-3;
  margin-bottom: $spacing-2;

  @include respond-to(md) {
    padding-bottom: $spacing-4;
    margin-bottom: $spacing-4;
  }
}

.mel-wizard-form-header__title {
  @include section-title;
  margin: 0 0 $spacing-2 0;
  color: $text-primary;
  line-height: $line-height-tight;
  font-weight: 600;

  @include respond-to(md) {
    font-size: $font-size-xl;
    margin-bottom: $spacing-3;
    font-weight: 600;
  }
}

.mel-wizard-form-header__help {
  @include small-text;
  margin: 0;
  color: $text-secondary;
  line-height: $line-height-normal;
  max-width: 42rem;

  @include respond-to(md) {
    font-size: $font-size-sm;
  }
}

// ============================================================================
// FORM BODY
// ============================================================================

.mel-wizard-form-body {
  flex: 1;
  min-width: 0;
  position: relative;

  // Ensure body has padding at bottom on mobile to prevent content
  // from being hidden behind sticky footer
  @include respond-down(md) {
    padding-bottom: 6rem;
  }

  // Ensure messages don't overlap with content
  > .messages {
    margin-bottom: $spacing-6;
    margin-top: 0;

    @include respond-to(md) {
      margin-bottom: $spacing-8;
    }
  }
}

// Error messages spacing
.mel-wizard-form-body .form-item--error-message {
  margin-top: $spacing-2;
  margin-bottom: $spacing-2;
  font-size: $font-size-sm;
  color: $danger;
}

// Validation errors container
.mel-wizard-form-body .mel-vendor-wizard__validation-errors {
  margin-bottom: $spacing-6;
  padding: $spacing-4;
  border-radius: $radius-md;
  background: $danger-light;
  border: 1px solid $danger;

  @include respond-to(md) {
    margin-bottom: $spacing-8;
    padding: $spacing-5;
  }
}

// Location warning
.mel-wizard-form-body .mel-vendor-wizard__location-warning {
  margin-bottom: $spacing-4;
  padding: $spacing-3 $spacing-4;
  border-radius: $radius-md;
  background: $warning-light;
  border: 1px solid $warning;

  @include respond-to(md) {
    margin-bottom: $spacing-6;
    padding: $spacing-4 $spacing-5;
  }
}

// ============================================================================
// ACTIONS / STICKY FOOTER (mobile)
// ============================================================================

.mel-wizard-form-body .mel-wizard__actions,
.mel-wizard-form-body .mel-vendor-wizard__actions {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: $spacing-3;
  margin-top: $spacing-6;
  padding-top: $spacing-4;
  border-top: 1px solid $border-color-light;

  @include respond-down(md) {
    position: fixed;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 100;
    margin: 0;
    padding: $spacing-4;
    padding-bottom: max($spacing-4, env(safe-area-inset-bottom));
    background: $bg-primary;
    border-top: 2px solid $border-color;
    box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.1), 0 -4px 16px rgba(0, 0, 0, 0.05);
    flex-wrap: nowrap;
    justify-content: flex-end;
    gap: $spacing-3;
    // Ensure safe area on devices with notches
    padding-left: max($spacing-4, env(safe-area-inset-left));
    padding-right: max($spacing-4, env(safe-area-inset-right));
  }

  @include respond-to(md) {
    border-top-color: $border-color-light;
    margin-top: $spacing-8;
    padding-top: $spacing-5;
  }
}

// Button base styles
.mel-wizard-form-body .mel-wizard__actions input[type="submit"],
.mel-wizard-form-body .mel-wizard__actions button[type="submit"],
.mel-wizard-form-body .mel-vendor-wizard__actions input[type="submit"],
.mel-wizard-form-body .mel-vendor-wizard__actions button[type="submit"] {
  margin: 0;
  min-height: 2.75rem;
  font-weight: 500;
  transition: all 0.2s ease;

  @include respond-down(md) {
    min-height: 3rem;
    font-size: $font-size-base;
  }

  // Focus states - always visible
  &:focus-visible {
    outline: 2px solid $primary;
    outline-offset: 2px;
    box-shadow: $shadow-focus;
  }
}

// Secondary actions (Back, Save Draft) - text links on mobile
.mel-wizard-form-body .mel-wizard__actions .mel-btn--secondary,
.mel-wizard-form-body .mel-vendor-wizard__actions .mel-btn--secondary,
.mel-wizard-form-body .mel-wizard__actions input[type="submit"]:not(.mel-btn--primary):not([class*="primary"]):not([name*="back"]),
.mel-wizard-form-body .mel-vendor-wizard__actions input[type="submit"]:not(.mel-btn--primary):not([class*="primary"]):not([name*="back"]) {
  @include respond-down(md) {
    background: transparent;
    border-color: transparent;
    color: $primary;
    padding: $spacing-2 $spacing-3;
    min-height: auto;
    font-size: $font-size-sm;
    order: 0;

    &:hover,
    &:focus {
      background: $bg-secondary;
      border-color: transparent;
      color: $primary-dark;
      text-decoration: underline;
    }

    &:focus-visible {
      outline: 2px solid $primary;
      outline-offset: 2px;
      box-shadow: none;
    }
  }
}

// Back button specific styling
.mel-wizard-form-body .mel-wizard__actions [name*="back"],
.mel-wizard-form-body .mel-vendor-wizard__actions [name*="back"] {
  @include respond-down(md) {
    order: 0;
  }
}

// Primary actions (Continue, Publish, Save Changes) - prominent on mobile
.mel-wizard-form-body .mel-wizard__actions .mel-btn--primary,
.mel-wizard-form-body .mel-vendor-wizard__actions .mel-btn--primary,
.mel-wizard-form-body .mel-wizard__actions input[type="submit"].mel-btn--primary,
.mel-wizard-form-body .mel-vendor-wizard__actions input[type="submit"].mel-btn--primary,
.mel-wizard-form-body .mel-wizard__actions [name*="next"],
.mel-wizard-form-body .mel-wizard__actions [name*="publish"],
.mel-wizard-form-body .mel-wizard__actions [name*="save"]:not(.mel-btn--secondary) {
  @include respond-down(md) {
    order: 1;
    flex: 1 1 auto;
    min-width: 8rem;
    max-width: 100%;
  }

  @include respond-to(md) {
    min-width: 10rem;
  }
}

// Ensure proper spacing between action groups
.mel-wizard-form-body .mel-wizard__actions > * + *,
.mel-wizard-form-body .mel-vendor-wizard__actions > * + * {
  @include respond-to(md) {
    margin-left: $spacing-3;
  }
}

// ============================================================================
// WIZARD PREVIEW (Review step inline event preview)
// ============================================================================
// Framed like a “window”: border, rounded corners, subtle shadow.
// Read-only: pointer-events disabled; no iframes; real event markup.
// Mobile-safe and responsive.

// Preview "window" — aligned with new look: coral accent border, rounded, shadow
.mel-wizard-preview {
  margin-top: $spacing-4;
  margin-bottom: $spacing-4;
  padding: $spacing-4;
  border: 2px solid rgba($wizard-coral, 0.2);
  border-radius: $radius-lg;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06), 0 0 0 1px rgba($wizard-coral, 0.05);
  background: $bg-primary;

  @include respond-to(md) {
    margin-top: $spacing-6;
    margin-bottom: $spacing-6;
    padding: $spacing-5;
    border-radius: $radius-xl;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08), 0 0 0 1px rgba($wizard-coral, 0.06);
  }
}

.mel-wizard-preview__title {
  margin: 0 0 $spacing-3 0;
  font-size: $font-size-base;
  font-weight: 600;
  color: $text-primary;

  @include respond-to(md) {
    margin-bottom: $spacing-4;
    font-size: $font-size-lg;
  }
}

.mel-wizard-preview--readonly .mel-wizard-preview__title + *,
.mel-wizard-preview--readonly [class*="node--event"] {
  pointer-events: none;
  user-select: none;
}

.mel-wizard-preview--readonly a {
  pointer-events: none;
  cursor: default;
}

// ============================================================================
// "Edit this section" affordance (Review step)
// ============================================================================
// Submit buttons that switch to that step (same as sidebar). Styled to match
// the new look: subtle coral-accent pill/links.

.mel-wizard-edit-sections {
  margin-top: $spacing-4;
  padding-top: $spacing-4;
  border-top: 1px solid $border-color-light;
}

.mel-wizard-edit-sections__links {
  display: flex;
  flex-wrap: wrap;
  gap: $spacing-2 $spacing-4;
}

// Edit section buttons (submit elements with class mel-wizard-edit-section-link)
.mel-wizard-edit-section-link,
button.mel-wizard-edit-section-link,
input.mel-wizard-edit-section-link {
  appearance: none;
  font-size: $font-size-sm;
  font-weight: 500;
  color: $text-secondary;
  text-decoration: none;
  background: transparent;
  border: 1px solid $border-color;
  border-radius: $radius-full;
  padding: $spacing-2 $spacing-3;
  cursor: pointer;
  transition: color 0.2s, background 0.2s, border-color 0.2s;

  &:hover {
    color: $wizard-coral;
    background: $wizard-coral-light;
    border-color: rgba($wizard-coral, 0.4);
    text-decoration: none;
  }

  &:focus-visible {
    outline: 2px solid $wizard-coral;
    outline-offset: 2px;
  }
}
