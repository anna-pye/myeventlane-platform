{%
  set card = card|default({
    url: '#',
    image_url: null,
    title: '',
    date: '',
    time: '',
    location: '',
    price: '',
    category: null,
    stamp: null,
    cta_label: 'Tickets',
    title_placement: 'below'
  })
%}

{% set is_promoted = is_promoted|default(false) %}
{% set title_mode_class = card.title_placement == 'overlay' ? 'mel-title--overlay' : 'mel-title--below' %}

<article class="mel-card mel-card--poster {{ title_mode_class }}{% if is_promoted %} mel-card--promoted{% endif %}">
  <a class="mel-card__link" href="{{ card.url }}">
    <div class="mel-card__media">
      {% if card.image_url %}
        <img src="{{ card.image_url }}" alt="{{ card.title }}" loading="lazy" decoding="async" class="mel-card__image" />
      {% else %}
        <div class="mel-card__media--placeholder" aria-hidden="true">
          <svg viewBox="0 0 800 450" xmlns="http://www.w3.org/2000/svg" role="img" aria-hidden="true">
            <defs>
              <linearGradient id="melPhPoster" x1="0" x2="1" y1="0" y2="1">
                <stop offset="0" stop-color="#f26d5b"/>
                <stop offset="0.5" stop-color="#6e7ef2"/>
                <stop offset="1" stop-color="#f5c04c"/>
              </linearGradient>
              <filter id="melSoftPoster" x="-10%" y="-10%" width="120%" height="120%">
                <feGaussianBlur stdDeviation="10"/>
              </filter>
            </defs>
            <rect width="800" height="450" fill="url(#melPhPoster)"/>
            <circle cx="140" cy="110" r="70" fill="#ffffff" opacity="0.22" filter="url(#melSoftPoster)"/>
            <circle cx="700" cy="120" r="90" fill="#ffffff" opacity="0.18" filter="url(#melSoftPoster)"/>
            <circle cx="640" cy="360" r="110" fill="#ffffff" opacity="0.14" filter="url(#melSoftPoster)"/>
            <g opacity="0.92">
              <rect x="285" y="140" width="230" height="210" rx="28" fill="#ffffff" opacity="0.18"/>
              <path d="M330 195h140a18 18 0 0 1 18 18v95a18 18 0 0 1-18 18H330a18 18 0 0 1-18-18v-95a18 18 0 0 1 18-18Z" fill="#ffffff" opacity="0.25"/>
              <path d="M355 170v40M445 170v40" stroke="#ffffff" stroke-width="14" stroke-linecap="round" opacity="0.45"/>
              <circle cx="365" cy="265" r="14" fill="#ffffff" opacity="0.55"/>
              <circle cx="415" cy="265" r="14" fill="#ffffff" opacity="0.55"/>
              <circle cx="465" cy="265" r="14" fill="#ffffff" opacity="0.55"/>
            </g>
            <text x="50%" y="420" text-anchor="middle" font-size="28" fill="#ffffff" opacity="0.9" font-family="system-ui, -apple-system, Segoe UI, Roboto, sans-serif">No image yet. Your event still slaps.</text>
          </svg>
        </div>
      {% endif %}

      {% if card.stamp %}
        <div class="mel-stamp">{{ card.stamp }}</div>
      {% endif %}

      {% if is_promoted %}
        <div class="mel-featured-badge" role="note" aria-label="{{ 'Featured event'|t }}">
          <span class="mel-featured-badge__icon" aria-hidden="true">✨</span>
          <span class="mel-featured-badge__text">{{ 'Featured'|t }}</span>
        </div>
      {% endif %}

      {% if card.category %}
        <div class="mel-pill mel-pill--category {{ card.category.color_class|default('') }}">
          {% if card.category.url %}
            <span class="mel-pill__text">{{ card.category.label }}</span>
          {% else %}
            <span class="mel-pill__text">{{ card.category.label }}</span>
          {% endif %}
        </div>
      {% endif %}

      {% if card.title_placement == 'overlay' %}
        <div class="mel-card__title-overlay">
          <h3 class="mel-card__title">{{ card.title }}</h3>
        </div>
      {% endif %}
    </div>

    <div class="mel-card__body">
      {% if card.title_placement != 'overlay' %}
        <h3 class="mel-card__title">{{ card.title }}</h3>
      {% endif %}

      <div class="mel-card__meta">
        {% if card.date or card.time %}
          <div class="mel-meta-line">
            <span class="mel-meta">{{ card.date }}</span>
            {% if card.time %}<span class="mel-meta-sep">•</span><span class="mel-meta">{{ card.time }}</span>{% endif %}
          </div>
        {% endif %}
        {% if card.location %}
          <div class="mel-meta-line">
            <span class="mel-meta">{{ card.location }}</span>
          </div>
        {% endif %}
      </div>

      <div class="mel-card__footer">
        {% if card.price %}
          <span class="mel-price">{{ card.price }}</span>
        {% endif %}
        <span class="mel-btn mel-btn--ghost">{{ card.cta_label }}</span>
      </div>
    </div>
  </a>
</article>
