// ==========================================================================
// Compact Card Component (MEL v2)
// ==========================================================================
// Dense event card for listings/search rows.

@use '../tokens/colors';
@use '../tokens/typography';
@use '../tokens/spacing';
@use '../tokens/radii';
@use '../tokens/shadows';
@use '../tokens/breakpoints';

// ---------------------------------------------------------------------------
// Compact Card Base
// ---------------------------------------------------------------------------

.mel-card--compact {
  // WARM: Default upcoming baseline (no extra emphasis).
  background: var(--mel-card, #{colors.$mel-color-surface});
  border-radius: var(--mel-radius-md, #{radii.$mel-radius-md});
  box-shadow: var(--mel-shadow-soft, 0 2px 8px rgba(0, 0, 0, 0.08));
  width: 100%;
  height: 72px;
  display: flex;
  flex-direction: row;
  text-decoration: none;
  color: inherit;
  transition: background-color 0.15s ease, box-shadow 0.15s ease, transform 0.15s ease;
  overflow: hidden;

  @include breakpoints.mel-break(md) {
    height: 92px;
  }

  // Hover state
  @media (hover: hover) and (pointer: fine) {
    &:hover,
    &:focus-visible {
      // Brand hover tint (lavender/purple), not CTA coral.
      background: rgba(108, 126, 242, 0.05);
      box-shadow: var(--mel-shadow-md, 0 2px 4px rgba(0, 0, 0, 0.08));
      transform: translateY(-2px);
    }
  }

  // Focus state
  &:focus-visible {
    outline: none;
    box-shadow: 0 0 0 2px var(--mel-card, #{colors.$mel-color-surface}),
                0 0 0 5px var(--mel-primary, #{colors.$mel-color-primary});
  }
}

.mel-card--compact .mel-card__link {
  display: flex;
  flex-direction: row;
  flex: 1;
  color: inherit;
  text-decoration: none;
  width: 100%;
  height: 100%;
  padding: 10px;
  gap: 10px;

  &:hover,
  &:focus,
  &:active {
    text-decoration: none;
    color: inherit;
  }
}

// ---------------------------------------------------------------------------
// Thumbnail
// ---------------------------------------------------------------------------

.mel-card__thumb {
  width: 72px;
  height: 100%;
  flex-shrink: 0;
  border-radius: 8px;
  overflow: hidden;
  background: linear-gradient(
    135deg,
    rgba(colors.$mel-color-navy, 0.04) 0%,
    rgba(colors.$mel-color-navy, 0.08) 100%
  );

  @include breakpoints.mel-break(md) {
    width: 88px;
  }
}

.mel-card__thumb img {
  width: 100%;
  height: 100%;
  display: block;
  object-fit: cover;
  object-position: center;
}

// ---------------------------------------------------------------------------
// Content Area
// ---------------------------------------------------------------------------

.mel-card__compact-body {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  min-width: 0; // Allow text truncation
}

.mel-card--compact .mel-card__compact-title {
  font-size: typography.mel-font-size(sm);
  font-weight: typography.$mel-font-bold;
  line-height: 1.18;
  margin: 0 0 2px;
  color: var(--mel-ink, #{colors.$mel-color-text});
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

// ---------------------------------------------------------------------------
// Meta Row
// ---------------------------------------------------------------------------

.mel-card__compact-meta {
  display: flex;
  flex-direction: row;
  gap: 8px;
  align-items: center;
  font-size: typography.mel-font-size(xs);
  color: var(--mel-muted, #{colors.$mel-color-text-muted});
}

.mel-card__meta-date,
.mel-card__meta-price {
  line-height: 1.4;
}

.mel-card__meta-price {
  font-weight: typography.$mel-font-semibold;
  color: var(--mel-ink, #{colors.$mel-color-text});
}

// ---------------------------------------------------------------------------
// Phase 7 — COOLING via Section Context (homepage only)
// ---------------------------------------------------------------------------
// Contextual de-emphasis only (no new markup/classes, no base rule changes).
// - Applies ONLY inside existing homepage section wrappers.
// - Excludes HOT cards (already marked with `.mel-card--promoted`).

.mel-home-section--recommended {
  .mel-card--compact:not(.mel-card--promoted) {
    // Stronger cooling: flatter elevation, slightly calmer hover.
    box-shadow: 0 1px 6px rgba(0, 0, 0, 0.08);

    @media (hover: hover) and (pointer: fine) {
      &:hover,
      &:focus-visible {
        // Keep interaction, reduce urgency (less lift + softer tint).
        background: rgba(108, 126, 242, 0.03);
        box-shadow: 0 1px 6px rgba(0, 0, 0, 0.08);
        transform: translateY(0);
      }
    }
  }
}

.mel-home-section--discover {
  .mel-card--compact:not(.mel-card--promoted) {
    // Lighter cooling: nearly baseline, just a calmer hover lift.
    @media (hover: hover) and (pointer: fine) {
      &:hover,
      &:focus-visible {
        background: rgba(108, 126, 242, 0.04);
        transform: translateY(-1px);
      }
    }
  }
}

// ---------------------------------------------------------------------------
// Phase 8 — PAST (ended + archived)
// ---------------------------------------------------------------------------
// Semantic hook: `.mel-card--past` is added by the node adapter when
// mel_event_state ∈ { ended, archived }.
//
// Rules:
// - Past is quieter than COOL.
// - Still readable/clickable (not disabled).
// - No hover lift.
// - HOT precedence preserved by excluding `.mel-card--promoted`.

.mel-card--compact.mel-card--past:not(.mel-card--promoted) {
  opacity: 0.82;
  filter: grayscale(0.25);
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.06);

  // Phase 10 — Lifecycle-aware CTA suppression (Past).
  // Keep CTAs visible + accessible, but remove urgency.
  .mel-btn--cta {
    background: rgba(108, 126, 242, 0.02);
    border-color: rgba(colors.$mel-color-navy, 0.12);
    transform: none;
  }

  @media (hover: hover) and (pointer: fine) {
    &:hover,
    &:focus-visible {
      background: rgba(108, 126, 242, 0.02);
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.06);
      transform: translateY(0);
    }
  }

  @media (hover: hover) and (pointer: fine) {
    .mel-btn--cta:hover {
      background: rgba(108, 126, 242, 0.03);
      transform: none;
    }
  }
}
