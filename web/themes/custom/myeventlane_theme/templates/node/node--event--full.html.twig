{{ attach_library('myeventlane_event/event_node') }}
{{ attach_library('myeventlane_theme/event-page') }}

{#
  MyEventLane
  Event full view
  Canonical layout with right sidebar (Tickets + Map)
#}

<article class="mel-event">
  {# Hero Image - Top of page, outside main card #}
  {% if content.field_event_image is defined and content.field_event_image|render %}
    <div class="mel-event-hero">
      {{ content.field_event_image }}
    </div>
  {% endif %}

  <div class="mel-event__wrap">

    {# =========================
       Main Event Column
       ========================= #}
    <div class="mel-event__main mel-card">

      <h1 class="mel-event__title">{{ label }}</h1>

      {# Venue Name - On its own line under title #}
      {% if content.field_venue_name is defined and content.field_venue_name|render %}
        <div class="mel-event__venue-name">
          {{ content.field_venue_name }}
        </div>
      {% endif %}

      {# Meta Pills - Date/Time, Category (colored), Organizer #}
      {% set has_meta = (content.field_event_start is defined and content.field_event_start|render)
        or (content.field_event_end is defined and content.field_event_end|render)
        or (event_categories is not empty)
        or (content.field_organizer is defined and content.field_organizer|render) %}
      {% if has_meta %}
        <div class="mel-event__meta">
          {% if content.field_event_start is defined and content.field_event_start|render %}
            <div class="mel-event__meta-item">
              {{ content.field_event_start }}
            </div>
          {% endif %}
          {% if content.field_event_end is defined and content.field_event_end|render %}
            <div class="mel-event__meta-item">
              {{ content.field_event_end }}
            </div>
          {% endif %}
          {% if event_categories is not empty %}
            {% for category in event_categories %}
              <div class="mel-event__category-pill" style="background-color: {{ category.color }}20; color: {{ category.color }}; border: 1px solid {{ category.color }}40;">
                {{ category.name }}
              </div>
            {% endfor %}
          {% endif %}
          {% if content.field_organizer is defined and content.field_organizer|render %}
            <div class="mel-event__meta-item">
              {{ content.field_organizer }}
            </div>
          {% endif %}
        </div>
      {% endif %}

      {% if content.body is defined %}
        <div class="mel-event__body">
          {{ content.body }}
        </div>
      {% endif %}

      {% set has_accessibility = (content.field_accessibility is defined and content.field_accessibility|render|trim is not empty)
        or (content.field_accessibility_contact is defined and content.field_accessibility_contact|render|trim is not empty)
        or (content.field_accessibility_directions is defined and content.field_accessibility_directions|render|trim is not empty)
        or (content.field_accessibility_entry is defined and content.field_accessibility_entry|render|trim is not empty)
        or (content.field_accessibility_parking is defined and content.field_accessibility_parking|render|trim is not empty) %}
      {% if has_accessibility %}
        <div class="mel-card mel-event__access">
          <strong>Accessibility information</strong>
          <div class="mel-event__access-body">
            {% if content.field_accessibility is defined and content.field_accessibility|render|trim is not empty %}
              {{ content.field_accessibility }}
            {% endif %}
            {% if content.field_accessibility_contact is defined and content.field_accessibility_contact|render|trim is not empty %}
              <div class="mel-event__access-item">
                <strong>Contact:</strong>
                {{ content.field_accessibility_contact }}
              </div>
            {% endif %}
            {% if content.field_accessibility_directions is defined and content.field_accessibility_directions|render|trim is not empty %}
              <div class="mel-event__access-item">
                <strong>Directions:</strong>
                {{ content.field_accessibility_directions }}
              </div>
            {% endif %}
            {% if content.field_accessibility_entry is defined and content.field_accessibility_entry|render|trim is not empty %}
              <div class="mel-event__access-item">
                <strong>Entry:</strong>
                {{ content.field_accessibility_entry }}
              </div>
            {% endif %}
            {% if content.field_accessibility_parking is defined and content.field_accessibility_parking|render|trim is not empty %}
              <div class="mel-event__access-item">
                <strong>Parking:</strong>
                {{ content.field_accessibility_parking }}
              </div>
            {% endif %}
          </div>
        </div>
      {% endif %}

    </div>

    {# =========================
       Sidebar Column
       ========================= #}
    <aside class="mel-event__sidebar">

      {# Tickets / RSVP CTA Card #}
      {% if event_cta and event_cta.primary %}
        <div class="mel-card mel-event__cta">
          <strong>
            {% if event_cta.mode == 'rsvp' %}
              RSVP
            {% elseif event_cta.mode == 'paid' or event_cta.mode == 'both' %}
              Tickets
            {% elseif event_cta.mode == 'external' %}
              Get Tickets
            {% else %}
              Registration
            {% endif %}
          </strong>
          <div class="mel-event__cta-action">
            {{ event_cta.primary }}
          </div>
          {% if event_cta.all.waitlist is defined %}
            <div class="mel-event__cta-secondary">
              {{ event_cta.all.waitlist }}
            </div>
          {% endif %}
        </div>
      {% endif %}

      {# Map Card - Use event_location_map render array if available #}
      {# Check both content array and elements array as fallback #}
      {% if content.event_location_map is defined and content.event_location_map|render|trim is not empty %}
        <div class="mel-card mel-event__map">
          {{ content.event_location_map }}
        </div>
      {% elseif elements.event_location_map is defined and elements.event_location_map|render|trim is not empty %}
        <div class="mel-card mel-event__map">
          {{ elements.event_location_map }}
        </div>
      {% elseif content.event_location_info is defined and content.event_location_info|render|trim is not empty %}
        <div class="mel-card mel-event__map">
          {{ content.event_location_info }}
        </div>
      {% elseif elements.event_location_info is defined and elements.event_location_info|render|trim is not empty %}
        <div class="mel-card mel-event__map">
          {{ elements.event_location_info }}
        </div>
      {% endif %}

    </aside>

  </div>
</article>
