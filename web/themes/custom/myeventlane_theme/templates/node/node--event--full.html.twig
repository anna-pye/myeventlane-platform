{{ attach_library('myeventlane_theme/myeventlane_event_full') }}

<article{{ attributes.addClass('mel-event') }}>
  <div class="mel-event__wrap">

    {% set hero = content.field_image ?? content.field_event_image ?? null %}

    {% if hero %}
      <header class="mel-event__hero" aria-label="Event image">
        {{ hero }}
      </header>
    {% endif %}

    <div class="mel-event__grid">
      <main class="mel-event__main">

        <section class="mel-card mel-event__intro">
          <h1 class="mel-event__title">{{ mel_title }}</h1>

          {% if mel_venue and mel_venue|trim != mel_title|trim %}
            <div class="mel-event__venue">{{ mel_venue }}</div>
          {% endif %}

          {% if mel_categories and mel_categories|length %}
            <div class="mel-event__pills" aria-label="Categories">
              {% for c in mel_categories %}
                {% set style = c.color ? ('--mel-pill:' ~ c.color ~ ';') : '' %}
                <span class="mel-pill mel-pill--tid-{{ c.tid }}" style="{{ style|e('html_attr') }}">{{ c.name }}</span>
              {% endfor %}
            </div>
          {% endif %}
        </section>

        <section class="mel-card mel-event__body">
          {{ content|without(
            'field_image',
            'field_event_image',
            'field_location',
            'field_event_address',
            'field_location_latitude',
            'field_location_longitude',
            'field_event_lat',
            'field_event_lng',
            'field_venue_name',
            'field_event_venue',
            'field_category',
            'field_categories',
            'field_event_category',
            'field_event_type',
            'field_event_start',
            'field_event_end',
            'field_capacity',
            'mel_ticket_cta',
            'event_location_map',
            'event_location_info'
          ) }}
        </section>

      </main>

      <aside class="mel-event__sidebar" aria-label="Sidebar">

        <section class="mel-card mel-event__tickets">
          <div class="mel-card__head">Tickets</div>
          <div class="mel-card__body">
            {% if content.mel_ticket_cta is defined and content.mel_ticket_cta %}
              {{ content.mel_ticket_cta }}
            {% else %}
              <div class="mel-muted">Tickets available soon.</div>
            {% endif %}
          </div>
        </section>

        <section class="mel-card mel-event__map">
          <div class="mel-card__head">Map</div>
          <div class="mel-card__body">
            {% if mel_lat is not null and mel_lng is not null %}
              <div
                class="myeventlane-event-map-container"
                data-latitude="{{ mel_lat }}"
                data-longitude="{{ mel_lng }}"
                data-lat="{{ mel_lat }}"
                data-lng="{{ mel_lng }}"
                data-title="{{ mel_title|trim }}"
                data-once="mel-event-map"></div>
            {% else %}
              <div class="mel-muted">Map unavailable.</div>
            {% endif %}

            {% if mel_address %}
              <div class="mel-event__address">
                <div class="mel-event__address-text">{{ mel_address }}</div>
                <a class="mel-link" target="_blank" rel="noopener"
                   href="https://www.google.com/maps/search/?api=1&query={{ mel_address|url_encode }}">
                  Get directions
                </a>
              </div>
            {% endif %}
          </div>
        </section>

        <section class="mel-card mel-event__details">
          <div class="mel-card__head">Details</div>
          <div class="mel-card__body">
            {% if mel_vendor %}
              <div class="mel-kv">
                <span class="mel-k">Vendor</span>
                <span class="mel-v">{{ mel_vendor }}</span>
              </div>
            {% endif %}
          </div>
        </section>

      </aside>
    </div>
  </div>
</article>
