{#
/**
 * @file
 * Event teaser card.
 */
#}

{# Variables expected from preprocess:
 * card_url
 * card_title
 * card_image_url (optional)
 * card_image_alt (optional)
 * card_day
 * card_month
 * card_time_range
 * card_location
 * card_category (array with 'label' and 'url')
 * card_price_label
 * card_type (rsvp|paid|both|none)
 * card_accessibility (array of strings or rendered markup, optional)
#}

<a href="{{ card_url|default(url|default('#')) }}" class="mel-event-card" aria-label="{{ card_title }}">
  <div class="mel-event-card__image">
    {% if card_image_url %}
      <img 
        src="{{ card_image_url }}" 
        alt="{{ card_image_alt|default(card_title) }}" 
        loading="lazy" 
        decoding="async"
        class="mel-event-card__image-element"
      />
      {# Fallback placeholder (hidden by default, shown if image fails to load) #}
      <div class="mel-event-card__placeholder mel-event-card__placeholder--fallback" aria-hidden="true">
        <svg class="mel-event-card__placeholder-svg" viewBox="0 0 800 450" xmlns="http://www.w3.org/2000/svg" role="img" aria-hidden="true">
          <defs>
            <linearGradient id="melPh" x1="0" x2="1" y1="0" y2="1">
              <stop offset="0" stop-color="#f26d5b"/>
              <stop offset="0.5" stop-color="#6e7ef2"/>
              <stop offset="1" stop-color="#f5c04c"/>
            </linearGradient>
            <filter id="melSoft" x="-10%" y="-10%" width="120%" height="120%">
              <feGaussianBlur stdDeviation="10"/>
            </filter>
          </defs>

          <rect width="800" height="450" fill="url(#melPh)"/>
          <circle cx="140" cy="110" r="70" fill="#ffffff" opacity="0.22" filter="url(#melSoft)"/>
          <circle cx="700" cy="120" r="90" fill="#ffffff" opacity="0.18" filter="url(#melSoft)"/>
          <circle cx="640" cy="360" r="110" fill="#ffffff" opacity="0.14" filter="url(#melSoft)"/>

          <g opacity="0.92">
            <rect x="285" y="140" width="230" height="210" rx="28" fill="#ffffff" opacity="0.18"/>
            <path d="M330 195h140a18 18 0 0 1 18 18v95a18 18 0 0 1-18 18H330a18 18 0 0 1-18-18v-95a18 18 0 0 1 18-18Z" fill="#ffffff" opacity="0.25"/>
            <path d="M355 170v40M445 170v40" stroke="#ffffff" stroke-width="14" stroke-linecap="round" opacity="0.45"/>
            <circle cx="365" cy="265" r="14" fill="#ffffff" opacity="0.55"/>
            <circle cx="415" cy="265" r="14" fill="#ffffff" opacity="0.55"/>
            <circle cx="465" cy="265" r="14" fill="#ffffff" opacity="0.55"/>
          </g>

          <text x="50%" y="420" text-anchor="middle" font-size="28" fill="#ffffff" opacity="0.9" font-family="system-ui, -apple-system, Segoe UI, Roboto, sans-serif">
            No image yet. Your event still slaps.
          </text>
        </svg>
      </div>
    {% else %}
      {# Primary placeholder (shown when no image URL provided) #}
      <div class="mel-event-card__placeholder" aria-hidden="true">
        <svg class="mel-event-card__placeholder-svg" viewBox="0 0 800 450" xmlns="http://www.w3.org/2000/svg" role="img" aria-hidden="true">
          <defs>
            <linearGradient id="melPh" x1="0" x2="1" y1="0" y2="1">
              <stop offset="0" stop-color="#f26d5b"/>
              <stop offset="0.5" stop-color="#6e7ef2"/>
              <stop offset="1" stop-color="#f5c04c"/>
            </linearGradient>
            <filter id="melSoft" x="-10%" y="-10%" width="120%" height="120%">
              <feGaussianBlur stdDeviation="10"/>
            </filter>
          </defs>

          <rect width="800" height="450" fill="url(#melPh)"/>
          <circle cx="140" cy="110" r="70" fill="#ffffff" opacity="0.22" filter="url(#melSoft)"/>
          <circle cx="700" cy="120" r="90" fill="#ffffff" opacity="0.18" filter="url(#melSoft)"/>
          <circle cx="640" cy="360" r="110" fill="#ffffff" opacity="0.14" filter="url(#melSoft)"/>

          <g opacity="0.92">
            <rect x="285" y="140" width="230" height="210" rx="28" fill="#ffffff" opacity="0.18"/>
            <path d="M330 195h140a18 18 0 0 1 18 18v95a18 18 0 0 1-18 18H330a18 18 0 0 1-18-18v-95a18 18 0 0 1 18-18Z" fill="#ffffff" opacity="0.25"/>
            <path d="M355 170v40M445 170v40" stroke="#ffffff" stroke-width="14" stroke-linecap="round" opacity="0.45"/>
            <circle cx="365" cy="265" r="14" fill="#ffffff" opacity="0.55"/>
            <circle cx="415" cy="265" r="14" fill="#ffffff" opacity="0.55"/>
            <circle cx="465" cy="265" r="14" fill="#ffffff" opacity="0.55"/>
          </g>

          <text x="50%" y="420" text-anchor="middle" font-size="28" fill="#ffffff" opacity="0.9" font-family="system-ui, -apple-system, Segoe UI, Roboto, sans-serif">
            No image yet. Your event still slaps.
          </text>
        </svg>
      </div>
    {% endif %}

    {% if card_day and card_month %}
      <div class="mel-event-card__date-badge" aria-hidden="true">
        <span class="mel-event-card__date-day">{{ card_day }}</span>
        <span class="mel-event-card__date-month">{{ card_month }}</span>
      </div>
    {% endif %}

    {% if card_type %}
      <span class="mel-event-pill mel-event-pill--sm
        {% if card_type == 'rsvp' %} mel-event-pill--rsvp{% endif %}
        {% if card_type == 'paid' %} mel-event-pill--paid{% endif %}
        {% if card_type == 'both' %} mel-event-pill--both{% endif %}
        {% if card_type == 'none' %} mel-event-pill--none{% endif %}
      ">
        <span class="mel-event-pill__label">
          {{ card_price_label }}
        </span>
      </span>
    {% endif %}
  </div>

  <div class="mel-event-card__body">
    <div class="mel-event-card__top">
      <h3 class="mel-event-card__title">{{ card_title }}</h3>

      {% if card_category %}
        <a href="{{ card_category.url }}" class="mel-event-card__category-pill" aria-label="{{ 'View events in'|t }} {{ card_category.label }}">
          {{ card_category.label }}
        </a>
      {% endif %}
    </div>

    <div class="mel-event-card__meta">
      {% if card_time_range %}
        <div class="mel-event-card__meta-item">
          <span class="mel-event-card__meta-icon" aria-hidden="true">üóìÔ∏è</span>
          <span>{{ card_time_range }}</span>
        </div>
      {% endif %}

      {% if card_location %}
        <div class="mel-event-card__meta-item">
          <span class="mel-event-card__meta-icon" aria-hidden="true">üìç</span>
          <span>{{ card_location }}</span>
        </div>
      {% endif %}
    </div>

    <div class="mel-event-card__bottom">
      {% if card_accessibility %}
        <div class="mel-event-card__accessibility" aria-label="{{ 'Accessibility features'|t }}">
          {% for item in card_accessibility %}
            <span class="mel-event-card__accessibility-item" aria-label="{{ item }}">‚úì</span>
          {% endfor %}
        </div>
      {% endif %}
    </div>
  </div>
</a>
