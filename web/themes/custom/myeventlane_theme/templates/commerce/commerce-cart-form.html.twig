{#
/**
 * @file
 * Theme override for the cart form.
 *
 * Available variables:
 * - form: The cart form with all its elements.
 */
#}

<div class="mel-cart">
  {# Cart Items #}
  <div class="mel-cart-items">
    <div class="mel-cart-header">
      <h1 class="mel-cart-title">
        Your Cart
        {% if form['#order_items']|length > 0 %}
          <span class="mel-cart-count">({{ form['#order_items']|length }} items)</span>
        {% endif %}
      </h1>
    </div>

    {% if form['#order_items']|length > 0 %}
      {# Group items by event for better UX and accessibility #}
      {% if grouped_items is defined and grouped_items|length > 0 %}
        {# Render event groups with headings #}
        {% for event_id, group in grouped_items %}
          <section class="mel-cart-event-group" data-event-id="{{ event_id }}">
            <h2 class="mel-cart-event-title">
              {{ group.event.label() }}
            </h2>
            {% if group.event.hasField('field_event_start') and not group.event.get('field_event_start').isEmpty() %}
              <div class="mel-cart-event-meta">
                <span class="mel-cart-event-date">
                  {{ group.event.get('field_event_start').value|date('F j, Y') }}
                </span>
                {% if group.event.hasField('field_location') and not group.event.get('field_location').isEmpty() %}
                  <span class="mel-cart-event-location" aria-label="{{ 'Location'|t }}">
                    {{ group.event.get('field_location').value }}
                  </span>
                {% endif %}
              </div>
            {% endif %}
          </section>
        {% endfor %}
        
        {# Items without event (shouldn't happen, but handle gracefully) #}
        {% if items_without_event is defined and items_without_event|length > 0 %}
          <section class="mel-cart-event-group">
            <h2 class="mel-cart-event-title">
              {{ 'Other Items'|t }}
            </h2>
          </section>
        {% endif %}
      {% endif %}
      
      {# Render Commerce's table (items are grouped visually via CSS based on event data) #}
      <div class="mel-cart-items-table"{% if item_event_map is defined %} data-item-event-map="{{ item_event_map|json_encode }}"{% endif %}>
        {{ form.header }}
        {{ form.output }}
      </div>
    {% else %}
      <div class="mel-cart-empty">
        <div class="mel-cart-empty-icon">ðŸ›’</div>
        <h2 class="mel-cart-empty-title">Your cart is empty</h2>
        <p class="mel-cart-empty-text">Looks like you haven't added any tickets yet.</p>
        <a href="/events" class="mel-btn mel-btn-primary">Browse Events</a>
      </div>
    {% endif %}
  </div>

  {# Cart Summary Sidebar #}
  {% if form['#order_items']|length > 0 %}
    <aside class="mel-cart-summary">
      <h2 class="mel-cart-summary-title">Order Summary</h2>

      <div class="mel-cart-summary-lines">
        {% if form.totals is defined %}
          {{ form.totals }}
        {% endif %}
      </div>

      <div class="mel-cart-total">
        <span class="mel-cart-total-label">Total</span>
        <span class="mel-cart-total-value">
          {% if form['#order'] is defined %}
            {{ form['#order'].getTotalPrice()|commerce_price_format }}
          {% endif %}
        </span>
      </div>

      <div class="mel-cart-actions">
        {{ form.actions }}
      </div>

      <p class="mel-checkout-security">Secure checkout</p>
    </aside>
  {% endif %}
</div>






