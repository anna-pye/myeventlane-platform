{#
/**
 * @file
 * Template for the event booking page.
 *
 * Available variables:
 * - title: The event title.
 * - event_date_text: Formatted event date string.
 * - venue_text: Venue name or location.
 * - hero_url: URL to hero image (optional).
 * - matrix_form: Render array for the product add-to-cart form.
 */
#}
<div class="mel-event-book-page">
  <div class="mel-container" style="max-width: 1200px; margin: 2rem auto; padding: 0 1rem;">
    <div class="mel-event-book-layout" style="display: grid; grid-template-columns: 1fr 400px; gap: 2rem; align-items: start;">
      
      {# Event Details Card (Left Side) #}
      <div class="mel-event-book-details-card mel-event-card" style="
        background: #fff;
        border-radius: 16px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        overflow: hidden;
        display: flex;
        flex-direction: column;
      ">
        {# Event Image #}
        {% if hero_url %}
          <div class="mel-event-book-image" style="
            width: 100%;
            height: 300px;
            overflow: hidden;
            background: #f0f0f0;
          ">
            <img src="{{ hero_url }}" alt="{{ title }}" style="
              width: 100%;
              height: 100%;
              object-fit: cover;
            ">
          </div>
        {% endif %}

        {# Event Info #}
        <div class="mel-event-book-details-body" style="padding: 1.5rem;">
          <h1 class="mel-event-book-title" style="
            font-size: 1.75rem;
            font-weight: 700;
            color: #1a1a2e;
            margin: 0 0 1rem 0;
          ">{{ title }}</h1>
          
          {% if event_date_text %}
            <div class="mel-event-book-meta" style="
              display: flex;
              align-items: center;
              gap: 0.5rem;
              margin-bottom: 0.75rem;
              color: #666;
              font-size: 0.95rem;
            ">
              <span style="font-size: 1.2rem;">üìÖ</span>
              <span>{{ event_date_text }}</span>
            </div>
          {% endif %}
          
          {% if venue_text %}
            <div class="mel-event-book-meta" style="
              display: flex;
              align-items: center;
              gap: 0.5rem;
              margin-bottom: 0;
              color: #666;
              font-size: 0.95rem;
            ">
              <span style="font-size: 1.2rem;">üìç</span>
              <span>{{ venue_text }}</span>
            </div>
          {% endif %}
        </div>
      </div>

      {# Booking Form Card (Right Side) #}
      <aside class="mel-event-book-form-card mel-event-card" style="
        background: #fff;
        border-radius: 16px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        padding: 1.5rem;
        position: sticky;
        top: 2rem;
        display: flex;
        flex-direction: column;
      ">
        <h2 class="mel-event-book-form-title" style="
          font-size: 1.25rem;
          font-weight: 700;
          color: #1a1a2e;
          margin: 0 0 1.5rem 0;
        ">
          {% if is_rsvp %}
            RSVP for Event
          {% else %}
            Book Tickets
          {% endif %}
        </h2>

        {# Add to Cart Form or RSVP Form #}
        <div class="mel-event-book-form">
          {% if matrix_form %}
            {# Render the entire form - Commerce handles the structure #}
            {{ matrix_form }}
          {% else %}
            <div class="mel-alert mel-alert--warning" style="
              padding: 1rem;
              background: #fff3cd;
              border: 1px solid #ffc107;
              border-radius: 8px;
              color: #856404;
            ">
              <p style="margin: 0;">{{ 'No tickets available for this event.'|t }}</p>
              <p style="margin: 0.5rem 0 0 0; font-size: 0.85rem; color: #666;">
                Debug: matrix_form is empty. Event type: {{ is_rsvp ? 'RSVP' : 'Paid' }}
              </p>
            </div>
          {% endif %}
        </div>
      </aside>

    </div>
  </div>
</div>

<style>
/* Responsive layout */
@media (max-width: 768px) {
  .mel-event-book-layout {
    grid-template-columns: 1fr !important;
  }
  
  .mel-event-book-form-card {
    position: static !important;
  }
}

/* Form styling */
.mel-event-book-form .form-item {
  margin-bottom: 1rem;
}

.mel-event-book-form label {
  display: block;
  font-weight: 600;
  margin-bottom: 0.5rem;
  color: #1a1a2e;
  font-size: 0.9rem;
}

.mel-event-book-form .form-actions {
  margin-top: 1.5rem;
}

.mel-event-book-form .button--add-to-cart,
.mel-event-book-form input[type='submit'],
.mel-event-book-form button[type='submit'],
.mel-event-book-form .form-actions .button {
  width: 100%;
  padding: 0.75rem 1.5rem;
  background: #ff6b35;
  color: white;
  border: none;
  border-radius: 8px;
  font-weight: 600;
  font-size: 1rem;
  cursor: pointer;
  transition: background 0.2s;
  text-align: center;
}

.mel-event-book-form .button--add-to-cart:hover,
.mel-event-book-form input[type='submit']:hover,
.mel-event-book-form button[type='submit']:hover,
.mel-event-book-form .form-actions .button:hover {
  background: #e55a2b;
}

/* Ensure form fields are visible */
.mel-event-book-form input[type='text'],
.mel-event-book-form input[type='number'],
.mel-event-book-form select {
  width: 100%;
  padding: 0.5rem;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 0.95rem;
}

/* Hide form elements that shouldn't be visible */
.mel-event-book-form .visually-hidden {
  position: absolute !important;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  width: 1px;
  height: 1px;
  word-wrap: normal;
}
</style>
