{#
/**
 * @file
 * Template for wizard review & publish page.
 *
 * Variables:
 * - title: Page title
 * - event: Event node
 * - steps: Step navigation array
 * - summary: Event summary groups (from WizardReviewSummaryBuilder)
 * - warnings: List of { message, severity, fix_route, fix_route_params }
 * - ready: { tickets_ready, location_ready, details_ready }
 * - tickets_edit_link: Rendered link to edit tickets (PHP-resolved, route-safe)
 * - publish_url: URL to publish the event
 * - card_preview: Rendered event teaser
 */
#}
<div class="mel-event-wizard">
  <div class="mel-event-wizard__layout">
    {# Wizard stepper moved to left sidebar (myeventlane_vendor_theme) #}
    <div class="mel-event-wizard__main">
      <div class="mel-wizard-step-card mel-wizard-step-card--review">
        <div class="mel-wizard-step-card__header">
          <h1 class="mel-wizard-step-card__title">{{ 'Almost there! Review your event'|t }}</h1>
          <p class="mel-wizard-step-card__description">
            {{ 'Take a moment to review your event details below. Once published, your event will be live and visible to attendees. You can always edit it later.'|t }}
          </p>
        </div>

        <div class="mel-wizard-step-card__content">
          {# Non-blocking warnings (if any) #}
          {% if warnings is not empty %}
            <div class="mel-wizard-review__warnings" role="region" aria-label="{{ 'Review suggestions'|t }}">
              <ul class="mel-wizard-review__warnings-list">
                {% for warning in warnings %}
                  <li class="mel-wizard-review__warning mel-wizard-review__warning--{{ warning.severity }}">
                    <span class="mel-wizard-review__warning-message">{{ warning.message }}</span>
                    <a href="{{ url(warning.fix_route, warning.fix_route_params) }}" class="mel-wizard-review__fix-link">{{ 'Fix'|t }}</a>
                  </li>
                {% endfor %}
              </ul>
            </div>
          {% endif %}

          {# Event card preview (matches /event/{node} listing) #}
          <div class="mel-review-card-preview">
            <h3 class="mel-review-card-preview__title">{{ 'Your event will look like this'|t }}</h3>
            <div class="mel-review-card-preview__card">
              {{ card_preview }}
            </div>
          </div>

          <div class="mel-wizard-review mel-review-summary">
            {% for section_key, section in summary %}
              <div class="mel-wizard-review__group mel-review-section">
                <div class="mel-review-section__header">
                  <h3 class="mel-review-section__title">{{ section.title }}</h3>
                  {% if section_key == 'basics' %}
                    <a href="{{ url('myeventlane_event.wizard.basics', {'event': event.id()}) }}" class="mel-review-section__edit">
                      {{ 'Edit'|t }}
                    </a>
                  {% elseif section_key == 'when_where' %}
                    <a href="{{ url('myeventlane_event.wizard.when_where', {'event': event.id()}) }}" class="mel-review-section__edit">
                      {{ 'Edit'|t }}
                    </a>
                  {% elseif section_key == 'tickets' %}
                    {% if tickets_edit_link %}
                      <div class="mel-review-section__edit">
                        {{ tickets_edit_link }}
                      </div>
                    {% endif %}
                  {% elseif section_key == 'details' %}
                    <a href="{{ url('myeventlane_event.wizard.details', {'event': event.id()}) }}" class="mel-review-section__edit">
                      {{ 'Edit'|t }}
                    </a>
                  {% endif %}
                </div>
                <dl class="mel-review-section__list">
                  {% for item in section.items %}
                    <div class="mel-review-section__item">
                      <dt class="mel-review-section__label">{{ item.label }}</dt>
                      <dd class="mel-review-section__value">{{ item.value }}</dd>
                    </div>
                  {% endfor %}
                  {% if section.items is empty %}
                    <div class="mel-review-section__item mel-review-section__item--empty">
                      <dd class="mel-review-section__value">{{ 'No details entered yet.'|t }}</dd>
                    </div>
                  {% endif %}
                </dl>
              </div>
            {% endfor %}
          </div>

          {# Visual-only reassurance checklist (does not gate publishing). #}
          <div class="mel-wizard-review__confidence-checklist" role="note" aria-label="{{ 'Pre-publish checklist'|t }}">
            <h2 class="mel-wizard-review__confidence-title">{{ 'Before you publish'|t }}</h2>
            <p class="mel-wizard-review__confidence-description">
              {{ 'Quick confidence check — you can always edit these anytime.'|t }}
            </p>
            <ul class="mel-wizard-review__confidence-list">
              <li class="mel-wizard-review__confidence-item">{{ 'Event details added'|t }}</li>
              <li class="mel-wizard-review__confidence-item">{{ 'Date & location set'|t }}</li>
              <li class="mel-wizard-review__confidence-item">{{ 'Tickets configured'|t }}</li>
              <li class="mel-wizard-review__confidence-item">{{ 'Accessibility & policies reviewed'|t }}</li>
            </ul>
          </div>

          {# Publish Actions #}
          <div class="mel-wizard-step-card__actions mel-wizard-step-card__actions--publish">
            <div class="mel-wizard-step-card__actions-primary">
              {% if publish_url %}
                <a href="{{ publish_url }}" class="mel-btn mel-btn--primary mel-btn--large">
                  ✨ {{ 'Publish Event'|t }}
                </a>
              {% endif %}
            </div>
            <div class="mel-wizard-step-card__actions-secondary">
              {% set prev_step = null %}
              {% for nav_step in steps %}
                {% if nav_step.is_current and not loop.first %}
                  {% set prev_step = steps[loop.index0 - 1] %}
                {% endif %}
              {% endfor %}
              {% if prev_step and prev_step.url %}
                <a href="{{ prev_step.url }}" class="mel-btn mel-btn--secondary">
                  {{ '← Back'|t }}
                </a>
              {% endif %}
              <a href="{{ url('myeventlane_event.wizard.basics', {'event': event.id()}) }}" class="mel-btn mel-btn--secondary">
                {{ 'Edit Details'|t }}
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
