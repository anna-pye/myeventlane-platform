services:
  # Lazy proxy for currency formatter to break circular dependency with serializer.
  # @see \Drupal\myeventlane_commerce\MyeventlaneCommerceServiceProvider
  myeventlane_commerce.currency_formatter.lazy:
    class: Drupal\myeventlane_commerce\Service\LazyCurrencyFormatter
    arguments:
      - !service_closure '@commerce_price.currency_formatter'

  # Logger channel for commerce module.
  logger.channel.myeventlane_commerce:
    parent: logger.channel_base
    arguments: ['myeventlane_commerce']

  myeventlane_commerce.paragraph_question_mapper:
    class: Drupal\myeventlane_commerce\Service\ParagraphQuestionMapper

  myeventlane_commerce.order_lock_subscriber:
    class: Drupal\myeventlane_commerce\EventSubscriber\LockAttendeeOnOrderPlaced
    tags:
      - { name: event_subscriber }

  myeventlane_commerce.field_attendee_data_write_subscriber:
    class: Drupal\myeventlane_commerce\EventSubscriber\FieldAttendeeDataWriteSubscriber
    arguments:
      - '@entity_type.manager'
    tags:
      - { name: event_subscriber }

  myeventlane_commerce.order_completed_subscriber:
    class: Drupal\myeventlane_commerce\EventSubscriber\OrderCompletedSubscriber
    arguments:
      - '@entity_type.manager'
      - '@logger.factory'
    tags:
      - { name: event_subscriber }

  myeventlane_commerce.stripe_connect_payment:
    class: Drupal\myeventlane_commerce\Service\StripeConnectPaymentService
    arguments:
      - '@entity_type.manager'
      - '@myeventlane_core.stripe'
      - '@config.factory'
      - '@logger.channel.myeventlane_commerce'

  myeventlane_commerce.platform_fee_order_processor:
    class: Drupal\myeventlane_commerce\OrderProcessor\PlatformFeeOrderProcessor
    arguments:
      - '@config.factory'
      - '@commerce_price.rounder'
    tags:
      - { name: commerce_order.order_processor, priority: 55 }

  myeventlane_commerce.platform_fee_order_presave_subscriber:
    class: Drupal\myeventlane_commerce\EventSubscriber\PlatformFeeOrderPresaveSubscriber
    arguments:
      - '@commerce_order.order_refresh'
    tags:
      - { name: event_subscriber }
