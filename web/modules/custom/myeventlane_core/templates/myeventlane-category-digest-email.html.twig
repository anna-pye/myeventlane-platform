{#
  MyEventLane Category Digest Email (inner-body-only)
  Wrapper is provided by Mime Mail theme override (mimemail-message.html.twig)
  Data: events_by_category = { categoryId => { category, events } }
#}

{% if user is defined and user %}
  <p style="margin: 0 0 12px 0;">
    Hi {{ user.name.value|default('there') }},
  </p>
{% endif %}

{% if intro is defined and intro %}
  <p style="margin: 0 0 16px 0;">
    {{ intro }}
  </p>
{% else %}
  <p style="margin: 0 0 16px 0;">
    Here are new events in the categories you follow.
  </p>
{% endif %}

{% if events_by_category is defined and events_by_category %}
  {% for category_data in events_by_category %}
    <div style="margin: 18px 0 10px 0;">
      <div style="font-weight: 700; font-size: 16px; line-height: 1.2; margin: 0 0 8px 0;">
        {{ category_data.category.label|default('Events') }}
      </div>

      {% if category_data.events %}
        <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%" style="border-collapse: collapse;">
          {% for event in category_data.events %}
            <tr>
              <td style="padding: 10px 0; border-top: 1px solid rgba(0,0,0,0.06);">
                <div style="font-weight: 700; margin: 0 0 4px 0;">
                  {% if event.url is defined and event.url %}
                    <a href="{{ event.url }}" style="color:#2c3e50; text-decoration: none;">
                      {{ event.title|default('Event') }}
                    </a>
                  {% else %}
                    {{ event.title|default('Event') }}
                  {% endif %}
                </div>

                {% set when_bits = [] %}
                {% if event.start_date is defined and event.start_date %}{% set when_bits = when_bits|merge([event.start_date]) %}{% endif %}
                {% if event.start_time is defined and event.start_time %}{% set when_bits = when_bits|merge([event.start_time]) %}{% endif %}

                {% set where_bits = [] %}
                {% if event.venue is defined and event.venue %}{% set where_bits = where_bits|merge([event.venue]) %}{% endif %}
                {% if event.location is defined and event.location %}{% set where_bits = where_bits|merge([event.location]) %}{% endif %}

                {% if when_bits|length %}
                  <div style="font-size: 14px; opacity: 0.9; margin: 0 0 2px 0;">
                    {{ when_bits|join(' • ') }}
                  </div>
                {% endif %}

                {% if where_bits|length %}
                  <div style="font-size: 14px; opacity: 0.85; margin: 0;">
                    {{ where_bits|join(' • ') }}
                  </div>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </table>
      {% else %}
        <p style="margin: 0 0 8px 0; opacity: 0.85;">No new events this period.</p>
      {% endif %}
    </div>
  {% endfor %}
{% else %}
  <p style="margin: 0 0 12px 0;">
    No new events in your followed categories right now.
  </p>
{% endif %}

{% if footer_note is defined and footer_note %}
  <p style="margin: 16px 0 0 0; font-size: 12px; opacity: 0.85;">
    {{ footer_note }}
  </p>
{% endif %}
